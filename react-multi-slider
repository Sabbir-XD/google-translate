'use client';

// Slick Carousel
import 'slick-carousel/slick/slick.css';
import 'slick-carousel/slick/slick-theme.css';

import Link from 'next/link';
import Slider from 'react-slick';
import React, { useRef } from 'react';
// const Slider = dynamic(() => import('react-slick'), { ssr: false });

import ArrowUpwardIcon from '@mui/icons-material/ArrowUpward';
import ArrowForwardIcon from '@mui/icons-material/ArrowForward';
import { createTheme, ThemeProvider } from '@mui/material/styles';
import CalendarTodayIcon from '@mui/icons-material/CalendarToday';
import {
  Box,
  Card,
  Chip,
  Grid,
  Button,
  Skeleton,
  CardMedia,
  IconButton,
  Typography,
  CardContent,
} from '@mui/material';

import { useEndpoints } from 'src/utils/useEndpoints';

import useApi from 'src/api/api';

// mock data
const mockData = [
  {
    id: 22,
    title: 'sdfgdgdfg',
    slug: 'sdfgdgdfg-1',
    thumbnail: 'http://192.168.88.174:3000/media/blogs/burnout-in-web-developers-1-1024x561.webp',
    is_banner: true,
    is_popular: true,
    description:
      'Thousands of students actively participate in our quizzes every day to improve their skills, track progress, and gain confidence through practice.',
    content:
      'Thousands of students actively participate in our quizzes every day to improve their skills, track progress, and gain confidence through practice.',
    category: 1,
    category_name: 'English Learning Tips',
    author: 'Md Imran Hasan',
    published_at: '2025-12-23',
    tags: 'vocabulary',
  },
  {
    id: 21,
    title: 'sdfgdgdfg',
    slug: 'sdfgdgdfg',
    thumbnail:
      'http://192.168.88.174:3000/media/blogs/best-web-development-course-in-bangladesh-2025-1.webp',
    is_banner: true,
    is_popular: true,
    description:
      'Thousands of students actively participate in our quizzes every day to improve their skills, track progress, and gain confidence through practice.',
    content:
      'Thousands of students actively participate in our quizzes every day to improve their skills, track progress, and gain confidence through practice.',
    category: 1,
    category_name: 'English Learning Tips',
    author: 'Md Imran Hasan',
    published_at: '2025-12-23',
    tags: 'vocabulary',
  },
  {
    id: 22,
    title: 'sdfgdgdfg',
    slug: 'sdfgdgdfg',
    thumbnail:
      'http://192.168.88.174:3000/media/blogs/best-web-development-course-in-bangladesh-2025-1.webp',
    is_banner: true,
    is_popular: true,
    description:
      'Thousands of students actively participate in our quizzes every day to improve their skills, track progress, and gain confidence through practice.',
    content:
      'Thousands of students actively participate in our quizzes every day to improve their skills, track progress, and gain confidence through practice.',
    category: 1,
    category_name: 'English Learning Tips',
    author: 'Md Imran Hasan',
    published_at: '2025-12-23',
    tags: 'vocabulary',
  },
  {
    id: 23,
    title: 'sdfgdgdfg',
    slug: 'sdfgdgdfg',
    thumbnail:
      'http://192.168.88.174:3000/media/blogs/best-web-development-course-in-bangladesh-2025-1.webp',
    is_banner: true,
    is_popular: true,
    description:
      'Thousands of students actively participate in our quizzes every day to improve their skills, track progress, and gain confidence through practice.',
    content:
      'Thousands of students actively participate in our quizzes every day to improve their skills, track progress, and gain confidence through practice.',
    category: 1,
    category_name: 'English Learning Tips',
    author: 'Md Imran Hasan',
    published_at: '2025-12-23',
    tags: 'vocabulary',
  },
];
// Green Theme
const greenTheme = createTheme({
  palette: {
    primary: { main: '#10b981', dark: '#059669', light: '#34d399' },
    secondary: { main: '#22c55e', dark: '#16a34a' },
    background: { default: '#f0fdf4', paper: '#ffffff' },
    text: { primary: '#064e3b', secondary: '#047857' },
  },
});

// BlogCard Component
const BlogCard = ({ blog, height, showButton = false, variant = 'default', category = true }) => {
  const formatDate = (dateString) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric',
      year: 'numeric',
    });
  };
  const truncateTitle = (title, maxLength) =>
    title.length > maxLength ? `${title.slice(0, maxLength)}...` : title;

  return (
    <Card
      sx={{
        height,
        borderRadius: 4,
        overflow: 'hidden',
        position: 'relative',
        cursor: 'pointer',
        transition: 'transform 0.3s ease, box-shadow 0.3s ease',
        // '&:hover': { boxShadow: '0 20px 40px rgba(16, 185, 129, 0.2)' },
        // '&:hover .overlay': {
        //   background:
        //     'linear-gradient(to top, rgba(6,78,59,0.95) 0%, rgba(6,78,59,0.7) 50%, transparent 100%)',
        // },
      }}
    >
      <CardMedia
        component="img"
        image={blog.thumbnail}
        alt={blog.title}
        sx={{ height: '100%', objectFit: 'cover' }}
      />

      <Box
        className="overlay"
        sx={{
          position: 'absolute',
          inset: 0,
          background: '#1C252E80',
          // background:
          //   variant === 'top-content'
          //     ? 'linear-gradient(to bottom, rgba(6,78,59,0.8) 0%, rgba(6,78,59,0.5) 50%, transparent 100%)'
          //     : 'linear-gradient(to top, rgba(6,78,59,0.9) 0%, rgba(6,78,59,0.6) 50%, transparent 100%)',
          transition: 'background 0.3s ease',
        }}
      />

      <CardContent
        sx={{
          position: 'absolute',
          ...(variant === 'top-content'
            ? { top: 0, left: 0, right: 0, p: 3 }
            : { bottom: 0, left: 0, right: 0, p: 4 }),
          color: 'white',
          zIndex: 2,
          display: 'flex',
          flexDirection: 'column',
          justifyContent: variant === 'top-content' ? 'flex-start' : 'flex-end',
          height: variant === 'top-content' ? '100%' : 'auto',
        }}
      >
        <Box sx={{ mb: variant === 'top-content' ? 'auto' : 2 }}>
          <Chip
            icon={<CalendarTodayIcon sx={{ fontSize: 14 }} />}
            label={formatDate(blog.published_at || blog.publishedAt)}
            size="small"
            sx={{
              // bgcolor: 'rgba(16, 185, 129, 0.9)',
              bgcolor: '#f3f3f3',
              color: 'black',
              fontWeight: 500,
              fontSize: '0.75rem',
              height: 22,
              borderRadius: 1,
              '& .MuiChip-icon': { color: 'black' },
            }}
          />
          {category && (
            <Chip
              label={blog.category_name || 'Web Development'}
              size="small"
              sx={{
                ml: 1,
                // bgcolor: 'rgba(34, 197, 94, 0.9)',
                bgcolor: 'white',
                color: 'black',
                fontWeight: 500,
                borderRadius: 1,
                fontSize: '0.75rem',
                height: 22,
              }}
            />
          )}
        </Box>

        <Typography
          variant={height > 300 ? 'h5' : 'subtitle1'}
          fontWeight={700}
          sx={{
            lineHeight: 1.3,
            textShadow: '0 2px 8px rgba(0,0,0,0.3)',
            mb: variant === 'top-content' ? 0 : 1,
          }}
        >
          {truncateTitle(blog.title, height > 300 ? 70 : 50)}
        </Typography>

        <Typography
          variant="body2"
          sx={{ opacity: 0.9, mb: 2, display: height > 300 ? 'block' : 'none' }}
        >
          By {blog.author || 'Md Imran'}
        </Typography>

        {showButton && (
          <Button
            variant="contained"
            endIcon={<ArrowForwardIcon />}
            sx={{
              mt: 2,
              bgcolor: '#059669',
              color: 'white',
              fontWeight: 600,
              textTransform: 'none',
              borderRadius: 2,
              px: 3,
              py: 1,
              opacity: 1,
              transform: 'translateY(0) scale(1.05)',
              transition: 'all 0.3s ease',
              '&:hover': { bgcolor: '#059669', transform: 'translateY(0) scale(1.05)' },
            }}
          >
            Read Full Article
          </Button>
        )}

        {variant === 'top-content' && (
          <IconButton
            sx={{
              position: 'absolute',
              bottom: 16,
              right: 16,
              bgcolor: 'rgba(16, 185, 129, 0.95)',
              color: 'white',
              width: 48,
              height: 48,
              '&:hover': { bgcolor: '#10b981', transform: 'rotate(45deg) scale(1.1)' },
            }}
          >
            <ArrowUpwardIcon />
          </IconButton>
        )}
      </CardContent>
    </Card>
  );
};

// Main Component
export default function HomeBlogCarouselSection() {
  const slider1 = useRef(null);
  const slider2 = useRef(null);
  const slider3 = useRef(null);
  const slider4 = useRef(null);
  const slider5 = useRef(null);

  const { blogs_pagination } = useEndpoints();
  const {
    data: apiAllBlogsData,
    isLoading: allDataLoading,
    error,
  } = useApi(blogs_pagination(1), {
    fetch: true,
  });

  const results = apiAllBlogsData?.results?.length > 0 ? apiAllBlogsData?.results : mockData;
  // console.log('blog result mock', results);
  const card1Data = results.slice(0, 5);
  const card2Data = [...results.slice(1, 4), results[0]].filter(Boolean);
  const card3Data = [...results.slice(2, 4), results[0], results[1]].filter(Boolean);
  const card4Data = [...results.slice(3, 4), ...results.slice(0, 3)].filter(Boolean);
  const card5Data = [...results.slice(4, 5), ...results.slice(0, 3)].filter(Boolean);

  // console.log('card data', card1Data);
  const sliderSettings = {
    dots: false,
    infinite: true,
    autoplay: true,
    autoplaySpeed: 4500,
    speed: 800,
    slidesToShow: 1,
    slidesToScroll: 1,
    arrows: false,
    pauseOnHover: false,
  };
  const sliderSettingsVertical = { ...sliderSettings, vertical: true };

  // Inside your component
  if (allDataLoading) {
    return (
      <ThemeProvider theme={greenTheme}>
        <Box
          component="section"
          sx={{ py: 8, background: 'linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)' }}
        >
          <Box sx={{ maxWidth: '1400px', mx: 'auto', px: { xs: 2, sm: 4 } }}>
            {/* Header Skeleton */}
            <Grid container justifyContent="space-between" alignItems="center" mb={6}>
              <Grid item xs={12} md={6} spacing={1}>
                <Skeleton variant="text" width="60%" height={60} sx={{ mb: 1 }} />
                <Skeleton variant="text" width="40%" height={60} />
              </Grid>
              <Grid item xs={12} md="auto" sx={{ mt: { xs: 2, md: 0 } }}>
                <Skeleton variant="rectangular" width={160} height={48} sx={{ borderRadius: 3 }} />
              </Grid>
            </Grid>

            {/* Carousel/Grid Skeleton */}
            <Grid container spacing={2}>
              {/* Left Large Skeleton */}
              <Grid item xs={12} xl={4}>
                <Skeleton variant="rectangular" height={480} sx={{ borderRadius: 4 }} />
              </Grid>

              {/* Middle Wide Skeleton */}
              <Grid item xs={12} xl={5}>
                <Skeleton variant="rectangular" height={480} sx={{ borderRadius: 4 }} />
              </Grid>

              {/* Right Two Small Skeletons */}
              <Grid item xs={12} xl={3} sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                <Skeleton variant="rectangular" height={230} sx={{ borderRadius: 4 }} />
                <Skeleton variant="rectangular" height={230} sx={{ borderRadius: 4 }} />
              </Grid>
            </Grid>
          </Box>
        </Box>
      </ThemeProvider>
    );
  }

  // if(error) return <ErrorShow message="Failed to load blogs. Please refresh." />;

  return (
    <ThemeProvider theme={greenTheme}>
      <Box
        component="section"
        sx={{ py: 8, background: 'linear-gradient(135deg, #f0fdf420 0%, #dcfce720 100%)' }}
      >
        <Box sx={{ maxWidth: 'xl', mx: 'auto', px: { xs: 2, sm: 4 } }}>
          {/* Header */}
          <Grid container justifyContent="space-between" alignItems="center" mb={6}>
            <Grid item xs={12} md={6}>
              <Typography
                variant="h3"
                sx={{
                  fontWeight: 800,
                  fontSize: { xs: '1.75rem', sm: '2.25rem', md: '2.75rem' },
                  mb: 1.5,
                  color: '#1A1A1A',
                  letterSpacing: 0.5,
                }}
              >
                Stay Updated with <br /> Our Latest Blog Posts
              </Typography>
            </Grid>
            <Grid item xs={12} md="auto" sx={{ mt: { xs: 2, md: 0 } }}>
              <Button
                component={Link}
                href="/blogs"
                variant="contained"
                endIcon={<ArrowForwardIcon />}
                sx={{
                  background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                  color: 'white',
                  borderRadius: 3,
                  textTransform: 'none',
                  px: 4,
                  py: 1.5,
                  fontSize: '1rem',
                  fontWeight: 600,
                  boxShadow: '0 4px 14px rgba(16, 185, 129, 0.4)',
                  '&:hover': {
                    transform: 'translateY(-2px)',
                    boxShadow: '0 6px 20px rgba(16, 185, 129, 0.5)',
                    background: 'linear-gradient(135deg, #059669 0%, #047857 100%)',
                  },
                }}
              >
                View All Blogs
              </Button>
            </Grid>
          </Grid>

          {/* Gallery Grid Layout */}
          <Grid container spacing={2}>
            {/* Left Side - 1 Large Card */}
            <Grid item xs={12} md={6} xl={4}>
              <Slider {...sliderSettings} ref={slider1}>
                {card1Data.map((blog) => (
                  <Link
                    key={blog.id}
                    href={`/en/blogs/${blog.slug}`}
                    style={{ textDecoration: 'none' }}
                  >
                    <BlogCard blog={blog} height={480} showButton />
                  </Link>
                ))}
              </Slider>
            </Grid>

            {/* Middle Part */}
            <Grid
              item
              xs={12}
              md={6}
              xl={5}
              sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}
            >
              {/* top */}
              <Grid container spacing={2} sx={{ flex: 1 }}>
                <Grid item xs={12} md={6} sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                  <Box sx={{ height: 229, flex: 1 }}>
                    <Slider {...sliderSettings} ref={slider2}>
                      {card2Data.map((blog) => (
                        <Link
                          key={blog.id}
                          href={`/en/blogs/${blog.slug}`}
                          style={{ textDecoration: 'none' }}
                        >
                          <BlogCard
                            blog={blog}
                            height={229}
                            variant="top-content"
                            category={false}
                          />
                        </Link>
                      ))}
                    </Slider>
                  </Box>
                </Grid>
                <Grid item xs={12} md={6} sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                  <Box sx={{ height: 229, flex: 1 }}>
                    <Slider {...sliderSettings} ref={slider3}>
                      {card3Data.map((blog) => (
                        <Link
                          key={blog.id}
                          href={`/en/blogs/${blog.slug}`}
                          style={{ textDecoration: 'none' }}
                        >
                          <BlogCard
                            blog={blog}
                            height={229}
                            variant="top-content"
                            category={false}
                          />
                        </Link>
                      ))}
                    </Slider>
                  </Box>
                </Grid>
              </Grid>

              {/* bottom */}
              <Box sx={{ height: 229 }}>
                <Slider {...sliderSettingsVertical} ref={slider4}>
                  {card4Data.map((blog) => (
                    <Link
                      key={blog.id}
                      href={`/en/blogs/${blog.slug}`}
                      style={{ textDecoration: 'none' }}
                    >
                      <BlogCard blog={blog} height={229} variant="top-content" />
                    </Link>
                  ))}
                </Slider>
              </Box>
            </Grid>

            {/* Right Side */}
            <Grid
              item
              // xs={12}
              // md={12}
              xl={3}
              sx={{ display: { xs: 'none', xl: 'block' }, flexDirection: 'column', gap: 2 }}
            >
              <Slider {...sliderSettings} ref={slider5}>
                {card5Data.map((blog) => (
                  <Link
                    key={blog.id}
                    href={`/en/blogs/${blog.slug}`}
                    style={{ textDecoration: 'none' }}
                  >
                    <BlogCard blog={blog} height={480} showButton />
                  </Link>
                ))}
              </Slider>
              {/* Top 1 Card */}
              {/* <Box sx={{ height: 229 }}>
                <Slider {...sliderSettings} ref={slider5}>
                  {card5Data.map((blog) => (
                    <Link
                      key={blog.id}
                      href={`/en/blogs/${blog.slug}`}
                      style={{ textDecoration: 'none' }}
                    >
                      <BlogCard blog={blog} height={229} />
                    </Link>
                  ))}
                </Slider>
              </Box>

         
              <Box sx={{ height: 229 }}>
                <Slider {...sliderSettingsVertical} ref={slider6}>
                  {card6Data.map((blog) => (
                    <Link
                      key={blog.id}
                      href={`/en/blogs/${blog.slug}`}
                      style={{ textDecoration: 'none' }}
                    >
                      <BlogCard blog={blog} height={229} variant="top-content" />
                    </Link>
                  ))}
                </Slider>
              </Box> */}
            </Grid>
            {/* <Grid item xs={12} md={12} xl={5}>
              <Box
                sx={{
                  display: 'flex',
                  justifyContent: 'center',
                  alignItems: 'center',
                  height: '100%',
                  border: '2px solid red',
                }}
              >
                <Grid container justifyContent="space-between" alignItems="center" mb={6}>
                  <Grid item xs={12}>
                    <Typography
                      variant="h3"
                      component="h2"
                      fontWeight={800}
                      sx={{
                        background: 'linear-gradient(135deg, #059669 0%, #10b981 100%)',
                        WebkitBackgroundClip: 'text',
                        WebkitTextFillColor: 'transparent',
                        mb: 1,
                      }}
                    >
                      Stay Updated with
                    </Typography>
                    <Typography
                      variant="h3"
                      component="h2"
                      fontWeight={800}
                      sx={{
                        background: 'linear-gradient(135deg, #10b981 0%, #34d399 100%)',
                        WebkitBackgroundClip: 'text',
                        WebkitTextFillColor: 'transparent',
                      }}
                    >
                      Our Latest Blog Posts
                    </Typography>
                  </Grid>
                  <Grid item xs={12} md="auto" sx={{ mt: { xs: 2, md: 0 } }}>
                    <Button
                      component={Link}
                      href="/blogs"
                      variant="contained"
                      endIcon={<ArrowForwardIcon />}
                      sx={{
                        background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                        color: 'white',
                        borderRadius: 3,
                        textTransform: 'none',
                        px: 4,
                        py: 1.5,
                        fontSize: '1rem',
                        fontWeight: 600,
                        boxShadow: '0 4px 14px rgba(16, 185, 129, 0.4)',
                        '&:hover': {
                          transform: 'translateY(-2px)',
                          boxShadow: '0 6px 20px rgba(16, 185, 129, 0.5)',
                          background: 'linear-gradient(135deg, #059669 0%, #047857 100%)',
                        },
                      }}
                    >
                      View All Blogs
                    </Button>
                  </Grid>
                </Grid>
              </Box>
            </Grid> */}
          </Grid>
        </Box>
      </Box>
    </ThemeProvider>
  );
}
